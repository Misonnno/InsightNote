name: Keep Supabase Active

on:
  schedule:
    - cron: '0 8 * * *'
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Send Authenticated Query
        run: |
          # 加上 -v 可以看到详细的请求过程，方便排查
          # 使用 API 具体的 URL 路径
          RESPONSE=$(curl -s -v -X GET "https://ndwuwthxyrfypogywfuv.supabase.co/rest/v1/notes?select=id&limit=1" \
          -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}" \
          -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}" \
          -H "Range: 0-9")
          
          echo "Response Body: $RESPONSE"
          
          # 如果返回结果包含 id，说明成功了
          if [[ $RESPONSE == *"id"* ]]; then
            echo "Successfully queried the database."
          else
            echo "Query failed or returned empty. Check your RLS policies or API Key."
            exit 1
          fi
